CONTEXT_ROOT="$1"
CONTEXT_PATH="$2"
CLOUDFLARE_ZONE_ID="$3"
CLOUDFLARE_CACHE_TOKEN="$4"

SSH_PRIVATE_KEY_PATH="$HOME/.ssh/${GITHUB_REPOSITORY:-publish-docs}"

if [ "$#" -ne 4 ]; then
  echo -e "not enough arguments USAGE:\n\n$0 \$CONTEXT_ROOT \$CONTEXT_PATH \$CLOUDFLARE_ZONE_ID \$CLOUDFLARE_CACHE_TOKEN\n\n" >&2
  exit 1
fi

CONTEXT="${CONTEXT_ROOT}${CONTEXT_PATH}"

curl -X GET "https://api.cloudflare.com/client/v4/user/tokens/verify" \
     -H "Authorization: Bearer $CLOUDFLARE_CACHE_TOKEN" \
     -H "Content-Type:application/json"

curl -v -X POST "https://api.cloudflare.com/client/v4/zones/$CLOUDFLARE_ZONE_ID/purge_cache" \
      -H "Content-Type:application/json" -H "Authorization: Bearer $CLOUDFLARE_CACHE_TOKEN" \
      --data "{\"files\":[\"https://docs.spring.io/${CONTEXT}_/css/site.css\", \"https://docs.spring.io/${CONTEXT}_/css/vendor/spring-tabs.css\", \"https://docs.spring.io/${CONTEXT}_/css/vendor/page-spring-projects.css\", \"https://docs.spring.io/${CONTEXT}_/css/vendor/search.css\", \"https://docs.spring.io/${CONTEXT}_/css/vendor/page-search.css\", \"https://docs.spring.io/${CONTEXT}_/css/vendor/asciidoctor-tabs.css\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-600.woff\", \"https://docs.spring.io/${CONTEXT}_/font/work-sans-v5-latin-regular.ttf\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-regular.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-700.ttf\", \"https://docs.spring.io/${CONTEXT}_/font/work-sans-v5-latin-regular.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/fontawesome-webfont.ttf\", \"https://docs.spring.io/${CONTEXT}_/font/metropolis-extrabold-webfont.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/metropolis-bold-webfont.woff\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-regular.ttf\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-regular.woff\", \"https://docs.spring.io/${CONTEXT}_/font/metropolis-regular-webfont.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-700.woff\", \"https://docs.spring.io/${CONTEXT}_/font/metropolis-regular-webfont.woff\", \"https://docs.spring.io/${CONTEXT}_/font/work-sans-v5-latin-700.woff\", \"https://docs.spring.io/${CONTEXT}_/font/work-sans-v5-latin-700.ttf\", \"https://docs.spring.io/${CONTEXT}_/font/work-sans-v5-latin-700.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-700.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/metropolis-bold-webfont.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/fontawesome-webfont.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-600.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-italic.woff2\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-600.ttf\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-italic.woff\", \"https://docs.spring.io/${CONTEXT}_/font/fontawesome-webfont.woff\", \"https://docs.spring.io/${CONTEXT}_/font/metropolis-extrabold-webfont.woff\", \"https://docs.spring.io/${CONTEXT}_/font/work-sans-v5-latin-regular.woff\", \"https://docs.spring.io/${CONTEXT}_/font/open-sans-v17-latin-italic.ttf\", \"https://docs.spring.io/${CONTEXT}_/js/site.js\", \"https://docs.spring.io/${CONTEXT}_/js/vendor/highlight.js\", \"https://docs.spring.io/${CONTEXT}_/js/vendor/page-spring-projects.js\", \"https://docs.spring.io/${CONTEXT}_/js/vendor/page-search.js\", \"https://docs.spring.io/${CONTEXT}_/js/vendor/asciidoctor-tabs.js\", \"https://docs.spring.io/${CONTEXT}_/js/vendor/search.js\", \"https://docs.spring.io/${CONTEXT}_/js/vendor/redirect.js\", \"https://docs.spring.io/${CONTEXT}_/js/vendor/spring-tabs.js\", \"https://docs.spring.io/${CONTEXT}_/js/vendor/import.js\", \"https://docs.spring.io/${CONTEXT}_/img/caret.svg\", \"https://docs.spring.io/${CONTEXT}_/img/menu-dark.svg\", \"https://docs.spring.io/${CONTEXT}_/img/home-o-dark.svg\", \"https://docs.spring.io/${CONTEXT}_/img/back-dark.svg\", \"https://docs.spring.io/${CONTEXT}_/img/algolia-light.svg\", \"https://docs.spring.io/${CONTEXT}_/img/search-by-algolia-light-background.svg\", \"https://docs.spring.io/${CONTEXT}_/img/chevron.svg\", \"https://docs.spring.io/${CONTEXT}_/img/back.svg\", \"https://docs.spring.io/${CONTEXT}_/img/search-by-algolia-dark-background.svg\", \"https://docs.spring.io/${CONTEXT}_/img/favicon.ico\", \"https://docs.spring.io/${CONTEXT}_/img/spring-logo.svg\", \"https://docs.spring.io/${CONTEXT}_/img/lorem.png\", \"https://docs.spring.io/${CONTEXT}_/img/home-o.svg\", \"https://docs.spring.io/${CONTEXT}_/img/algolia-dark.svg\", \"https://docs.spring.io/${CONTEXT}_/img/chevron-white.svg\", \"https://docs.spring.io/${CONTEXT}_/img/home-dark.svg\", \"https://docs.spring.io/${CONTEXT}_/img/octicons-16.svg\", \"https://docs.spring.io/${CONTEXT}_/img/home.svg\", \"https://docs.spring.io/${CONTEXT}_/img/menu.svg\"]}"